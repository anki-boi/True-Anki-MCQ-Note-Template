<!-- Import Font Awesome using a <link> tag (more reliable in Anki) -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<div class="check-container"><span id="check"></span></div>

<p>{{Question}}</p>

{{#Multiple Choice}}
<div id="choices" class="back">{{Multiple Choice}}</div>
<div id="answer" hidden>{{Correct Answer}}</div>
{{/Multiple Choice}}

{{^Multiple Choice}}
<hr>
{{Correct Answer}}
{{/Multiple Choice}}

{{#Extra}}
<div class="extra">{{Extra}}</div>
{{/Extra}}

<!-- Social Media Buttons Start Here -->
<div class="social-links">
  <!-- GitHub -->
  <a href="https://github.com/anki-boi/True-Anki-MCQ-Note-Template" title="GitHub" aria-label="GitHub">
    <i class="fab fa-github"></i>
  </a>

  <!-- Reddit -->
  <a href="https://www.reddit.com/user/Useful_Disaster_7606/" title="Reddit" aria-label="Reddit">
    <i class="fab fa-reddit"></i>
  </a>
  
  <!-- Open Source Link (Using the Gist URL provided) -->
  <a href="https://gist.github.com/anki-boi/04b92068e753799130b5185b478cc513" title="Open Source Guide/Resource" aria-label="Open Source Guide/Resource">
    <i class="fab fa-osi"></i> 
  </a>
  
  <!-- Gist Button - Now a Copy & Redirect Action -->
  <a href="javascript:void(0);" 
     title="Copy Prompt & Go to Gemini" 
     aria-label="Copy Prompt & Go to Gemini" 
     onclick="copyAndRedirect(event); return false;">
    <i class="fa-brands fa-creative-commons-share"></i> 
  </a>
</div>
<!-- Social Media Buttons End Here -->

<!-- JavaScript required for the copy and redirect functionality -->
<script>
function copyAndRedirect(event) {
  // Prevent the link from navigating
  if (event) {
    event.preventDefault();
    event.stopPropagation();
  }

  const promptText = ` ** PROMPT FOR CSV CREATION**

**Objective:**
Create a targeted yet comprehensive set of multiple-choice questions (MCQs) covering the most high-yield aspects of the provided text. The goal is to achieve maximum coverage with minimum redundancy. Prioritize depth, uniqueness, and comprehension, while ensuring questions are challenging and well-formatted.

**Key Instructions:**

**1. Coverage & Priority:**
- Generate questions based on the following priority hierarchy:
    1.  Classification
    2.  Specific Drug/Substance Names
    3.  Mechanism of Action (MoA)
    4.  Therapeutic Uses
    5.  Adverse Effects
    6.  Common Names / Nicknames
    7.  Constituents
- Create questions about other unique, testable facts found in the text, even if they don't fit the categories above.
- Crucially, keep the question set lean. For reciprocal facts (e.g., 'What is the application of Method X?' vs. 'What is the method for Application Y?'), always prioritize the version that asks for the specific detail (the application, substance, or description) when given the broader category (the method or class). For example, prefer asking "Vitamins assayed by Fluorometry include:" over asking "The method used to assay Vitamins B1 and B2 is:". The goal is to test the recall of specific details associated with a known category.
- True or false questions are strictly forbidden.
- The best version of a redundant question is one that asks for the name of a specific species.
- Ignore exercises and sample problems in the source text.

**2. Distractor Quality & Choice Parity (CRITICAL):**
- **Contextual Relevance:** Incorrect options (distractors) MUST be contextually relevant. They should be from the same general category as the correct answer to test for nuanced understanding (e.g., a question about a specific antibiotic should use other antibiotics as distractors).
- **Structural & Length Parity:** All options in the \`Multiple Choice\` column should be of **similar length and grammatical structure**. Avoid making the correct answer noticeably longer or more detailed than the distractors.
- **Avoid Parenthetical Giveaways:** If a correct answer requires a clarification in parentheses (e.g., \`Drug X (Class Y)\`), add plausible, contextually relevant clarifications in the same format to the distractors as well. EXTREMELY EXTREMELY IMPORTANT OR ELSE CUTE KITTENS WILL DIE.
- **The goal is to make the correct answer indistinguishable from the distractors based on formatting or length alone.**

**3. Question & Answer Phrasing:**
- Avoid phrases like "According to the text," "from the provided text," etc.
- Avoid ambiguous pronouns such as "this," "that," or "it."
- Be concise in the question column unless more detail is needed to avoid ambiguity.
- Do not use "What," "Which," "Where," "How," or "Why." Follow the example statement-like formatting.
- In the \`Question\` and \`Extra\` columns, never refer to images or the text itself.
- **Mnemonic Isolation:** Strictly isolate mnemonics to the \`Extra\` column. The \`Question\`, \`Multiple Choice\`, and \`Correct Answers\` columns must **not** contain any hints, wordplay, or direct phrasing from the mnemonic.

**4. AI Knowledge & Corrections:**
- Stay within the provided text for creating questions and answers, but you are encouraged to use your broader knowledge to enrich the \`Extra\` column.
- Add a \`Rationale:\` to the \`Extra\` column whenever possible to provide context.
- If you identify a factual error in the source text, create the question using the corrected information. In the \`Extra\` column, add a note detailing the correction (e.g., \`Note: Source text stated [incorrect fact], which has been corrected to [correct fact].\`).

**5. Formatting & Structure:**
- Use pipes \`|\` as separators for the CSV columns.
- Skip the \`Question|Multiple Choice|Correct Answers|Extra\` headers.
- Use HTML line breaks \`<br>\` to separate items in the \`Multiple Choice\` and \`Correct Answers\` columns. **This is the only HTML tag permitted in these two columns.**
- The number of multiple choice options should always be greater than the number of correct answers. Create at the very least 6 choices.
- HTML tags like \`<b>\`, \`<i>\`, and \`<u>\` are **only permitted** in the \`Question\` and \`Extra\` columns. Use them to emphasize key words in the \`Question\` column and for formatting in the \`Extra\` column. Avoid overlapping HTML tags.
- Image tags / references (if provided) are to be added to the end of their respective cards at the bottom of the Extra Column

**6. Example (Reflecting All Final Rules):**

\`\`\`
Question|Multiple Choice|Correct Answers|Extra
Classes of drugs for <b>diabetes mellitus</b>:|Insulin secretagogues<br>Biguanides<br>Thiazolidinediones<br>Alpha-glucosidase inhibitors<br>Incretin-based drugs<br>SGLT2 Inhibitors<br>Alkaloids<br>Carbamates|Insulin secretagogues<br>Biguanides<br>Thiazolidinediones<br>Alpha-glucosidase inhibitors<br>Incretin-based drugs<br>SGLT2 Inhibitors<br>Amylin Analogues|Rationale: Except for insulin injections, which are the primary treatment for Type 1 DM but also used in Type 2, the other listed oral hypoglycemic agents are used for Type 2 DM.<br><br>Mnemonic: <b>I</b>n <b>B</b>right <b>T</b>imes, <b>A</b>ll <b>I</b>ndividuals <b>S</b>hine <b>A</b>gain.
Mechanism of action of <b>Insulin Secretagogues</b>:|Blockade of ATP-sensitive K+ channels<br>Activation of AMP-activated protein kinase<br>Agonism of PPAR-γ receptors<br>Inhibition of alpha-glucosidase enzymes<br>Stimulation of glucagon-like peptide-1<br>Inhibition of sodium-glucose cotransporter 2|Blockade of ATP-sensitive K+ channels|Rationale: Blocking ATP-sensitive K+ channels leads to membrane depolarization, which opens voltage-gated Ca2+ channels. The subsequent influx of calcium triggers the exocytosis of insulin-containing granules from the β-cells.<br><br>Mnemonic: <i>Secret</i>-<b>B</b>K+ blockers
Biguanide drug largely withdrawn from the market due to a high risk of fatal <b>lactic acidosis</b>:|Phenformin<br>Metformin<br>Buformin<br>Empagliflozin<br>Acarbose<br>Pioglitazone|Phenformin|Rationale: Phenformin carries a significantly higher risk of causing lactic acidosis compared to metformin because of its chemical structure, which leads to greater inhibition of mitochondrial respiration.
Plant sources rich in <b>tannins</b>:|Psidium guajava (Guava)<br>Hamamelis virginiana (Witch Hazel)<br>Quercus infectoria (Oak galls)<br>Syzygium cumini (Java plum)<br>Ginkgo biloba (Ginkgo)<br>Panax ginseng (Ginseng)|Psidium guajava (Guava)<br>Hamamelis virginiana (Witch Hazel)<br>Quercus infectoria (Oak galls)<br>Syzygium cumini (Java plum)|Rationale: The listed plants are notable for their high tannin content. Distractors like Ginkgo and Ginseng are known for other active compounds (ginkgolides, ginsenosides).
The primary antioxidant lignan constituents of <b>Sesamum indicum</b>:|Sesamol<br>Sesamolin<br>Gossypol<br>Ricin<br>Theobromine<br>Anethole|Sesamol<br>Sesamolin|Rationale: Sesamol and sesamolin are powerful antioxidants in sesame oil. The distractors are toxic or primary constituents of other plants: Gossypol (cottonseed), Ricin (castor bean), Theobromine (cacao), and Anethole (anise).
Causative organisms of <b>Rat-bite fever</b>:|Streptobacillus moniliformis<br>Spirillum minus<br>Leptospira interrogans<br>Yersinia pestis<br>Francisella tularensis<br>Borrelia burgdorferi|Streptobacillus moniliformis<br>Spirillum minus|Rationale: Rat-bite fever is a zoonotic disease caused by two different bacteria. The distractors are also causative agents of zoonotic diseases: Leptospirosis (<i>Leptospira</i>), Plague (<i>Yersinia</i>), Tularemia (<i>Francisella</i>), and Lyme disease (<i>Borrelia</i>).
\`\`\`

[PASTE YOUR TEXT OR SCREENSHOTS HERE]`;
  
  const GEMINI_STUDIO_URL = "https://aistudio.google.com/app";

  // --- Copy Logic ---
  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(promptText).then(() => {
      window.open(GEMINI_STUDIO_URL, '_blank');
    }).catch(err => {
      console.error('Failed to copy text: ', err);
      fallbackCopyTextToClipboard(promptText, GEMINI_STUDIO_URL);
    });
  } else {
    fallbackCopyTextToClipboard(promptText, GEMINI_STUDIO_URL);
  }
  
  return false;
}

function fallbackCopyTextToClipboard(text, redirectUrl) {
  const textArea = document.createElement("textarea");
  textArea.value = text;
  
  textArea.style.top = "0";
  textArea.style.left = "0";
  textArea.style.position = "fixed";

  document.body.appendChild(textArea);
  textArea.focus();
  textArea.select();

  try {
    const successful = document.execCommand('copy');
    if (successful) {
       window.open(redirectUrl, '_blank');
    } else {
       alert('Copy failed. Please copy the text manually and then navigate to Gemini.');
    }
  } catch (err) {
    alert('Copy failed. Please copy the text manually and then navigate to Gemini.');
  }

  document.body.removeChild(textArea);
}
</script>
<script>
// v0.5.3 - https://github.com/SimonLammer/anki-persistence/blob/7107e73086189c190c4d326ef11ebbcded9a08c6/script.js
if(void 0===window.Persistence){var _persistenceKey="github.com/SimonLammer/anki-persistence/",_defaultKey="_default";if(window.Persistence_sessionStorage=function(){var e=!1;try{"object"==typeof window.sessionStorage&&(e=!0,this.clear=function(){for(var e=0;e<sessionStorage.length;e++){var t=sessionStorage.key(e);0==t.indexOf(_persistenceKey)&&(sessionStorage.removeItem(t),e--)}},this.setItem=function(e,t){void 0==t&&(t=e,e=_defaultKey),sessionStorage.setItem(_persistenceKey+e,JSON.stringify(t))},this.getItem=function(e){return void 0==e&&(e=_defaultKey),JSON.parse(sessionStorage.getItem(_persistenceKey+e))},this.removeItem=function(e){void 0==e&&(e=_defaultKey),sessionStorage.removeItem(_persistenceKey+e)})}catch(e){}this.isAvailable=function(){return e}},window.Persistence_windowKey=function(e){var t=window[e],i=!1;"object"==typeof t&&(i=!0,this.clear=function(){t[_persistenceKey]={}},this.setItem=function(e,i){void 0==i&&(i=e,e=_defaultKey),t[_persistenceKey][e]=i},this.getItem=function(e){return void 0==e&&(e=_defaultKey),void 0==t[_persistenceKey][e]?null:t[_persistenceKey][e]},this.removeItem=function(e){void 0==e&&(e=_defaultKey),delete t[_persistenceKey][e]},void 0==t[_persistenceKey]&&this.clear()),this.isAvailable=function(){return i}},window.Persistence=new Persistence_sessionStorage,Persistence.isAvailable()||(window.Persistence=new Persistence_windowKey("py")),!Persistence.isAvailable()){var titleStartIndex=window.location.toString().indexOf("title"),titleContentIndex=window.location.toString().indexOf("main",titleStartIndex);titleStartIndex>0&&titleContentIndex>0&&titleContentIndex-titleStartIndex<10&&(window.Persistence=new Persistence_windowKey("qt"))}}
</script>

<script>
	(function () {
	  // Preprocess - convert <br> to <li>
	  var choicesDiv = document.getElementById('choices');
	  if (choicesDiv && choicesDiv.className === 'back') {
		var existingLIs = choicesDiv.querySelectorAll('li');
		
		if (existingLIs.length === 0) {
		  // If no <li> elements exist, process the content
		  var content = choicesDiv.innerHTML;
		  // Split content by <br> tags
		  var choices = content.split(/<br\s*\/?>/i);
		  // Clear existing content
		  choicesDiv.innerHTML = '';
		  // Create a new ul element
		  var ul = document.createElement('ul');
		  // Add each choice as an <li> element
		  choices.forEach(function(choice) {
			if (choice.trim() !== '') {
			  var li = document.createElement('li');
			  li.innerHTML = choice.trim();
			  ul.appendChild(li);
			}
		  });
		  // Add the ul to the choicesDiv
		  choicesDiv.appendChild(ul);
		}
	  }
	  
	  var data = { answered: {}, position: [] };

	  var els = document.querySelectorAll("#choices li");
	  var answerElement = document.querySelector("#answer");
	  var count = els.length;

		var correctAnswers = [];
		if (answerElement) {
		  // Convert the innerHTML to text, replacing <br> with newlines
		  var tempDiv = document.createElement('div');
		  tempDiv.innerHTML = answerElement.innerHTML.replace(/<br\s*\/?>/gi, '\n');
		  var textAnswers = tempDiv.textContent || tempDiv.innerText || '';
		  
		  // Split by newlines and clean up
		  correctAnswers = textAnswers.split('\n').map(function(item) {
			return item.trim();
		  }).filter(function(item) {
			return item !== '';
		  });
		}

	  for (let i = 0; i < count; ++i) {
		els[i].insertAdjacentHTML('afterbegin', '<input type="checkbox"> ');
	  }

	  // Check if each choice matches any of the correct answers
	  for (let idx = 0; idx < count; idx++) {
		var choiceText = els[idx].textContent.trim();
		// Remove the leading checkbox from the text when comparing
		choiceText = choiceText.replace(/^\s*□\s*/, '').trim();
		
		if (correctAnswers.includes(choiceText)) {
		  els[idx].querySelector('input').checked = true;
		  els[idx].className = 'success';
		}
	  }

	  if (!Persistence.isAvailable()) {
		return;
	  }
	  
	  data = Persistence.getItem();
	  if (data === null) {
		return;
	  }
	  
	  Persistence.clear();

	  var correct = true;
	  // Check that user selected all correct answers and only correct answers
	  for (let idx = 0; idx < count; idx++) {
		var choiceText = els[idx].textContent.trim().replace(/^\s*□\s*/, '').trim();
		var isCorrect = correctAnswers.includes(choiceText);
		var wasSelected = !!data.answered[idx];
		
		// If this is a correct answer but user didn't select it, or
		// if this is not a correct answer but user did select it
		if ((isCorrect && !wasSelected) || (!isCorrect && wasSelected)) {
		  correct = false;
		}
		
		// Visual feedback
		els[idx].querySelector('input').checked = wasSelected;
		if (wasSelected) {
		  if (isCorrect) {
			els[idx].className = 'success';
		  } else {
			els[idx].className = 'error'; // Wrong selection
		  }
		} else if (isCorrect) {
		  els[idx].className = 'missed'; // Missed correct answer
		}
	  }

	  if (data.answered !== undefined && Object.keys(data.answered).length != 0) {
		if (correct) {
		  document.getElementById('check').innerHTML = 'Correct';
		  document.getElementById('check').className = 'success';
		} else {
		  document.getElementById('check').innerHTML = 'Wrong';
		  document.getElementById('check').className = 'error';
		}
	  }

	  // Re-order to same order as previous page
	  var ul = els[0].parentNode;
	  var li_nodes = [];
	  for (let idx = count - 1; idx >= 0; idx--) {
		li_nodes.unshift(els[idx]);
		ul.removeChild(els[idx]);
	  }
	  for (let idx = 0; idx < count; idx++) {
		ul.appendChild(li_nodes[data.position[idx]]);
	  }
	})();
</script>
